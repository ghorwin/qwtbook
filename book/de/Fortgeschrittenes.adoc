:imagesdir: ../images

<<<
[[sec:advanced]]
# Fortgeschrittene Themen

Die nachfolgend vorgestellten Themen greifen in die internen Datenstrukturen der Qwt-Bibliotheksklassen ein und diese könnten sich in zukünftigen Bibliotheksversionen sicher nocheinmal deutlich ändern.
Daher sind diese Techniken mit Vorsicht zu genießen!



[[sec:releasingObjectsFromQwtPlot]]
## Objekte aus dem QwtPlot loslösen

Die API des `QwtPlot` geht davon aus, dass Objekt beim Hinzufügen/Ersetzen existierender Plotelemente das Plot als neuen Eigentümer erhalten. Sobald ein Plotelement ein vorheriges Plotelement ersetzt, löscht das `QwtPlot` das alte Objekt automatisch. Es gibt keine _release_-Funktionen, wie man die von _shared pointer_-Implementierungen kennt. Daher kann man einmal hinzugefügte Objekte nicht entfernen, anpassen und wieder neu hinzufügen.

Bei Plotelementen, welche mittels `QwtPlotItem::attach()` hinzugefügt wurden, kann man das Element einfach mit `QwtPlotItem::detach()` wieder entfernen.

Bei der Legende geht das so jedoch nicht.

TODO den entfern-Trick erklären...


[[sec:splines]]
## Splines und Bézier-Kurven

TODO ...

In diesem Fall instanziiert und konfiguriert man eine der Implementierungen und ruft dann die Funktion: `QwtSpline::polygon( const QPolygonF&, double tolerance )` auf. Das erste Argument ist der zu fittende Polygonzug und das zweite Argument die Toleranz, welche die Länge der generierten Liniensegmente definiert. Die Funktion liefert selbst einen Linienzug als `QPolygonF` zurück, welcher dann weiter verwendet werden kann. Die Anzahl der Stützstellen im Polygonzug wird durch die Toleranz so definiert, dass die maximale Abweichung zwischen dem Liniensegment und der originalen Splinekurve diese Toleranz nicht überschreitet. Damit werden in Bereichen stärkerer Krümmung mehr Punkte gesetzt als in eher linearen Abschnitten der Kurve.

Die Stützstellen der Beispielkurve oben werden in einen Polygonzug gesteckt und durch die Spline in einen neuen Polygonzug konvertiert. Die Toleranz von 0.01 erzeugt hier 95 Punkte.

```c++
QPolygonF poly;
for (int i=0; i<x.count(); ++i)
	poly << QPointF(x[i],y[i]);
QPolygonF splinePoly = spline->polygon(poly, 1e-2);
```

.Liniensegmentkurve mit Stützstellen generiert aus QwtSplinePleasing
image::CurveFitterSplinePleasingPolygon.png[pdfwidth=10cm]

Wie man sehen kann, werden die Punkte in den Krümmungsstellen stärker geclustert. 

